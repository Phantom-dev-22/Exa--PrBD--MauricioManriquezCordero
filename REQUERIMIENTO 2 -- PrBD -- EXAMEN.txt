--REQUERIMIENTO 2 -- PrBD -- EXAMEN

CREATE OR REPLACE TRIGGER ALUMNO_JORNADA
BEFORE INSERT OR UPDATE OR DELETE ON ALUMNO
FOR EACH ROW
DECLARE
    V_DIA  NUMBER;  -- Día de la semana
    V_HORA NUMBER;  -- Hora en formato 24 horas
BEGIN
    V_DIA := TO_NUMBER(TO_CHAR(SYSDATE, 'D'));  -- Obtiene el día (1=Domingo, 2=Lunes, ..., 7=Sábado)
    V_HORA := TO_NUMBER(TO_CHAR(SYSDATE, 'HH24'));  -- Obtiene la hora en formato 24h

    -- Verifica si la operación ocurre en días laborales (lunes a viernes) y horario permitido
    IF (V_DIA BETWEEN 2 AND 6) AND (V_HORA BETWEEN 8 AND 18) THEN
        NULL;  -- Permitir la operación
    ELSE
        -- Si la operación ocurre fuera del horario permitido
        IF INSERTING THEN
            RAISE_APPLICATION_ERROR(-20501, 'SE DEBE INSERTAR VALORES SOLO EN LA JORNADA DE TRABAJO');
        ELSIF UPDATING THEN
            RAISE_APPLICATION_ERROR(-20503, 'NO PUEDE MODIFICAR A LOS ALUMNOS FUERA DE LA JORNADA DE TRABAJO');
        ELSIF DELETING THEN
            RAISE_APPLICATION_ERROR(-20502, 'NO PUEDE ELIMINAR VALORES DE LA TABLA FUERA DE LA JORNADA DE TRABAJO');
        END IF;
    END IF;
END;
/

--INGRESAR UN NUEVO ALUMNO 
INSERT INTO ALUMNO ( COD_ALUMNO, NUMRUT_ALUMNO, DVRUT_ALUMNO, PNOMBRE_ALUMNO, SNOMBRE_ALUMNO, APPAT_ALUMNO, APMAT_ALUMNO, BECADO, COD_CURSO
) VALUES ( 2222, '12345678', '9', 'JUAN', 'PABLO', 'PEREZ', 'GOMEZ', 'N', 223);

--ELIMINAR UN ALUMNO
DELETE FROM ALUMNO WHERE COD_ALUMNO = 2222;

--ACTUALIZAR EL NOMBRE DE UN ALUMNO
UPDATE ALUMNO SET PNOMBRE_ALUMNO = 'MARIO' WHERE COD_ALUMNO = 2222;